<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Export-Historie - SBS Deutschland</title>
  <link rel="stylesheet" href="/static/css/design-tokens.css">
  <link rel="stylesheet" href="/static/css/components.css">
  <style>
    .export-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .export-table th, .export-table td { padding: 14px 16px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    .export-table th { background: #f8f9fa; font-weight: 600; color: #374151; }
    .export-table tr:hover { background: #f8f9fa; }
    
    .type-badge { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
    .type-badge.excel { background: #d1fae5; color: #065f46; }
    .type-badge.csv { background: #dbeafe; color: #1d4ed8; }
    .type-badge.datev { background: #fef3c7; color: #92400e; }
    .type-badge.xrechnung { background: #ede9fe; color: #5b21b6; }
    .type-badge.zip { background: #fce7f3; color: #9d174d; }
    
    .stats-row { display: flex; gap: 20px; margin-bottom: 30px; }
    .stat-box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex: 1; text-align: center; }
    .stat-box h4 { color: #666; font-size: 13px; margin: 0 0 8px 0; }
    .stat-box .value { font-size: 28px; font-weight: bold; color: #003856; }
    
    .filter-bar { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
    .filter-bar select { padding: 10px 16px; border: 1px solid #ddd; border-radius: 8px; }
  </style>
</head>
<body>
  {% include 'partials/header.html' %}
  
  <section class="section-padding" style="background: #f5f5f5; min-height: calc(100vh - 200px);">
    <div class="container">
      <h1 style="color: #003856; margin-bottom: 30px;">üì• Export-Historie</h1>
      
      <!-- Stats -->
      <div class="stats-row">
        <div class="stat-box">
          <h4>Exporte gesamt</h4>
          <div class="value">{{ stats.total }}</div>
        </div>
        <div class="stat-box">
          <h4>Diese Woche</h4>
          <div class="value">{{ stats.this_week }}</div>
        </div>
        <div class="stat-box">
          <h4>Rechnungen exportiert</h4>
          <div class="value">{{ stats.total_invoices }}</div>
        </div>
        <div class="stat-box">
          <h4>Gesamtvolumen</h4>
          <div class="value">{{ "%.0f"|format(stats.total_amount or 0) }}‚Ç¨</div>
        </div>
      </div>
      
      <!-- Filter -->
      <div class="filter-bar">
        <select id="typeFilter" onchange="filterExports()">
          <option value="">Alle Typen</option>
          <option value="excel">Excel</option>
          <option value="csv">CSV</option>
          <option value="datev">DATEV</option>
          <option value="xrechnung">XRechnung</option>
          <option value="zip">ZIP</option>
        </select>
      </div>
      
      <!-- Table -->
      <table class="export-table" id="exportTable">
        <thead>
          <tr>
            <th>Datum</th>
            <th>Typ</th>
            <th>Dateiname</th>
            <th>Rechnungen</th>
            <th>Betrag</th>
            <th>Gr√∂√üe</th>
          </tr>
        </thead>
        <tbody>
          {% for exp in exports %}
          <tr data-type="{{ exp.export_type }}">
            <td>{{ exp.created_at[:16] if exp.created_at else '-' }}</td>
            <td>
              <span class="type-badge {{ exp.export_type }}">
                {% if exp.export_type == 'excel' %}üìä Excel
                {% elif exp.export_type == 'csv' %}üìÑ CSV
                {% elif exp.export_type == 'datev' %}üè¶ DATEV
                {% elif exp.export_type == 'xrechnung' %}üìú XRechnung
                {% elif exp.export_type == 'zip' %}üì¶ ZIP
                {% else %}{{ exp.export_type }}{% endif %}
              </span>
            </td>
            <td>{{ exp.filename or '-' }}</td>
            <td>{{ exp.invoice_count or 0 }}</td>
            <td>{{ "%.2f"|format(exp.total_amount or 0) }}‚Ç¨</td>
            <td>{{ "%.1f"|format((exp.file_size or 0) / 1024) }} KB</td>
          </tr>
          {% else %}
          <tr><td colspan="6" style="text-align: center; color: #666;">Keine Exporte</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
  
  <script>
    function filterExports() {
      const type = document.getElementById('typeFilter').value;
      document.querySelectorAll('#exportTable tbody tr').forEach(row => {
        row.style.display = !type || row.dataset.type === type ? '' : 'none';
      });
    }
  </script>
  
  {% include 'partials/footer.html' %}
</body>
</html>
