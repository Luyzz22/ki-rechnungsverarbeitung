<header class="header">
  <div class="header-inner">
    <a href="/" class="logo-wrap">
      <img src="/static/sbs-logo-new.png" alt="SBS Deutschland" class="logo-img" />
      <div class="logo-text"><strong>SBS Deutschland</strong><span>Smart Business Service Â· Weinheim</span></div>
    </a>

    <button class="burger" id="burger" aria-label="MenÃ¼">
      <span></span><span></span><span></span>
    </button>

    <nav class="nav" id="nav">
      <!-- Hauptnavigation fÃ¼r alle User -->
      <a href="/">Upload</a>
      <a href="/history">Verlauf</a>
      <a href="/analytics">Analytics</a>
      
      <!-- Tools Dropdown -->
      <div class="dropdown">
        <span class="dropdown-toggle">Tools</span>
        <div class="dropdown-menu">
          <a href="/copilot">ğŸ¤– Finance Copilot</a>
          <a href="/accounting">ğŸ“Š Auto-Kontierung</a>
          <a href="/email-config">ğŸ“§ Email-Inbox</a>
        </div>
      </div>

      <!-- Account Dropdown -->
      <div class="account-dropdown">
        <span class="account-toggle">ğŸ‘¤ <span id="accountName">Account</span> â–¾</span>
        <div class="account-menu">
          <!-- User Info Header -->
          <div class="account-menu-header" id="accountHeader">
            <strong id="accountFullName">Account</strong>
            <span id="accountEmail"></span>
          </div>
          
          <div class="divider"></div>
          <div class="dropdown-section">Workspace</div>
          <a href="/">ğŸ“¥ Upload</a>
          <a href="/history">ğŸ“Š Verlauf</a>
          <a href="/analytics">ğŸ“ˆ Analytics</a>
          <a href="/exports">ğŸ“ Export-Historie</a>

          <div class="divider"></div>
          <div class="dropdown-section">Konto</div>
          <a href="/profile">âš™ï¸ Einstellungen</a>
          <a href="/account">ğŸ’³ Abrechnung</a>
          <a href="/team">ğŸ‘¥ Team</a>
          <a href="/audit-log">ğŸ“œ Audit-Log</a>
          
          <!-- Admin Section - nur fÃ¼r Admins sichtbar -->
          <div class="divider admin-only" style="display:none;"></div>
          <div class="dropdown-section admin-only" style="display:none;">Administration</div>
          <a href="/admin" class="admin-only" style="display:none;">ğŸ”§ System-Dashboard</a>
          <a href="/admin/users" class="admin-only" style="display:none;">ğŸ‘¥ User-Verwaltung</a>
          <a href="/analytics/costs" class="admin-only" style="display:none;">ğŸ’° API-Kosten</a>
          
          <div class="divider"></div>
          <a href="/logout" class="logout-link">ğŸšª Abmelden</a>
        </div>
      </div>
    </nav>
  </div>
</header>

<script>
  // Burger Menu Toggle
  const burger = document.getElementById('burger');
  const nav = document.getElementById('nav');
  if (burger && nav) {
    burger.addEventListener('click', () => {
      nav.classList.toggle('open');
      burger.classList.toggle('active');
    });
  }

  // User Info & Admin Check laden
  async function loadUserInfo() {
    try {
      const res = await fetch('/api/user', {credentials: 'include'});
      const user = await res.json();
      
      if (user && user.logged_in) {
        // Name setzen
        const nameEl = document.getElementById('accountName');
        const fullNameEl = document.getElementById('accountFullName');
        const emailEl = document.getElementById('accountEmail');
        
        if (nameEl) nameEl.textContent = user.name || 'Account';
        if (fullNameEl) fullNameEl.textContent = user.name || 'Account';
        if (emailEl) emailEl.textContent = user.email || '';
        
        // Admin-Links anzeigen wenn Admin
        if (user.is_admin) {
          document.querySelectorAll('.admin-only').forEach(el => {
            el.style.display = '';
          });
        }
      }
    } catch(e) {
      console.error('User info error:', e);
    }
  }
  document.addEventListener('DOMContentLoaded', loadUserInfo);
</script>
