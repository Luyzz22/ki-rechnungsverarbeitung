<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Upload - SBS KI-Rechnungsverarbeitung</title>
  <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>

<header class="header">
  <div class="header-inner">
    <a href="https://sbsdeutschland.com/" class="logo-wrap">
      <img src="/static/sbs-logo-new.png" alt="SBS Deutschland" class="logo-img" />
      <div class="logo-text"><strong>SBS Deutschland</strong><span>Smart Business Service Â· Weinheim</span></div>
    </a>
    <nav class="nav">
      <div class="dropdown">
        <span class="dropdown-toggle">Leistungen</span>
        <div class="dropdown-menu">
          <a href="https://sbsdeutschland.com/landing">ğŸ¤– KI-Rechnungsverarbeitung</a>
          <a href="https://sbsdeutschland.com/sbshomepage/sap-consulting.html">ğŸ“Š SAP Consulting</a>
          <a href="https://sbsdeutschland.com/sbshomepage/it-consulting.html">ğŸ’» IT Consulting</a>
          <a href="https://sbsdeutschland.com/sbshomepage/met-pmo.html">ğŸ“ Metrologie & PMO</a>
          <a href="https://sbsdeutschland.com/sbshomepage/quality-risk-management.html">ğŸ¯ Quality & Risk</a>
        </div>
      </div>
      <a href="https://sbsdeutschland.com/preise">Preise</a>
      <a href="https://sbsdeutschland.com/sbshomepage/kontakt.html">Kontakt</a>
      <div class="account-dropdown">
        <span class="account-toggle">ğŸ‘¤ <span id="accountName">Account</span> â–¾</span>
        <div class="account-menu">
          <a href="/history">ğŸ“Š Verlauf</a>
          <a href="/analytics">ğŸ“ˆ Analytics</a>
          <a href="/email-config">ğŸ“§ Email-Inbox</a>
          <a href="/profile">âš™ï¸ Einstellungen</a>
          <div class="divider"></div>
          <a href="/logout">ğŸšª Logout</a>
        </div>
      </div>
    </nav>
  </div>
</header>

<main class="main-content">
  <div class="hero-compact">
    <div class="hero-content">
      <div class="hero-badge">ğŸ¤– KI-RECHNUNGSVERARBEITUNG</div>
      <h1>Rechnungen intelligent verarbeiten</h1>
      <p>Laden Sie Ihre Rechnungen hoch und unsere KI extrahiert automatisch alle relevanten Daten</p>
    </div>
  </div>

  <section style="max-width:1200px;margin:60px auto;padding:0 24px;">
    <div id="uploadBox" style="border:3px dashed #e5e7eb;border-radius:16px;padding:80px 40px;text-align:center;cursor:pointer;background:white;margin-bottom:40px;transition:all 0.3s;">
      <input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display:none;">
      <div style="font-size:5rem;margin-bottom:24px;">ğŸ“</div>
      <h2 style="color:#003856;margin-bottom:12px;">Dateien hochladen</h2>
      <p style="color:#666;font-size:1.1rem;">Klicken oder Dateien hierher ziehen</p>
      <p style="color:#999;font-size:0.9rem;margin-top:8px;">PDF, JPG oder PNG (max. 20 MB pro Datei)</p>
    </div>

    <div id="fileListBox" style="display:none;background:white;border-radius:16px;padding:40px;box-shadow:0 4px 16px rgba(0,0,0,0.08);margin-bottom:40px;">
      <h3 style="color:#003856;margin-bottom:24px;">ğŸ“‹ Hochgeladene Dateien (<span id="fileCount">0</span>)</h3>
      <div id="fileList" style="max-height:550px;overflow-y:auto;margin-bottom:20px;"></div>
      <button id="processBtn" style="background:linear-gradient(135deg,#FFB900 0%,#ff9500 100%);color:#003856;border:none;padding:18px 40px;border-radius:12px;font-size:1.2rem;font-weight:bold;cursor:pointer;width:100%;box-shadow:0 4px 16px rgba(255,185,0,0.3);">âš¡ Jetzt verarbeiten</button>
    </div>

    <div id="progressBox" style="display:none;background:white;border-radius:16px;padding:60px 40px;text-align:center;box-shadow:0 4px 16px rgba(0,0,0,0.08);">
      <div style="font-size:4rem;margin-bottom:24px;">âš™ï¸</div>
      <h2 style="color:#003856;margin-bottom:16px;">Verarbeitung lÃ¤uft...</h2>
      <div style="width:100%;height:40px;background:#e5e7eb;border-radius:20px;overflow:hidden;margin:30px 0;">
        <div id="progressFill" style="height:100%;background:linear-gradient(90deg,#003856 0%,#FFB900 100%);width:0%;transition:width 0.3s;"></div>
      </div>
      <p id="progressText" style="color:#666;font-size:1.1rem;">Bitte warten...</p>
    </div>
  </section>
</main>

<footer class="footer">
  <div class="footer-grid">
    <div>
      <div class="footer-brand">
        <img src="/static/sbs-logo-new.png" alt="SBS Deutschland" />
        <div class="footer-brand-text">
          <strong>SBS Deutschland</strong>
          <span>Smart Business Service</span>
        </div>
      </div>
      <p class="footer-tagline">Ihr Partner fÃ¼r intelligente GeschÃ¤ftsprozesse und KI-LÃ¶sungen aus der Rhein-Neckar-Region.</p>
      <div class="footer-location">ğŸ“ In der Dell 19, 69469 Weinheim</div>
    </div>
    <div>
      <h4>Produkte</h4>
      <ul><li><a href="/">ğŸ¤– KI-Rechnungsverarbeitung</a></li></ul>
    </div>
    <div>
      <h4>Beratung</h4>
      <ul>
        <li><a href="https://sbsdeutschland.com/sbshomepage/it-consulting.html">ğŸ’» IT Consulting</a></li>
        <li><a href="https://sbsdeutschland.com/sbshomepage/sap-consulting.html">ğŸ“Š SAP Consulting</a></li>
        <li><a href="https://sbsdeutschland.com/sbshomepage/quality-risk.html">ğŸ¯ Quality & Risk</a></li>
        <li><a href="https://sbsdeutschland.com/sbshomepage/metrologie-pmo.html">ğŸ“ Metrologie & PMO</a></li>
      </ul>
    </div>
    <div>
      <h4>Unternehmen</h4>
      <ul>
        <li><a href="https://sbsdeutschland.com/sbshomepage/about.html">Ãœber uns</a></li>
        <li><a href="https://sbsdeutschland.com/sbshomepage/kontakt.html">Kontakt</a></li>
        <li><a href="https://sbsdeutschland.com/preise">Preise</a></li>
      </ul>
    </div>
    <div>
      <h4>Rechtliches</h4>
      <ul>
        <li><a href="https://sbsdeutschland.com/sbshomepage/impressum.html">Impressum</a></li>
        <li><a href="https://sbsdeutschland.com/sbshomepage/datenschutz.html">Datenschutz</a></li>
        <li><a href="https://sbsdeutschland.com/sbshomepage/agb.html">AGB</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <p>&copy; 2025 SBS Deutschland GmbH & Co. KG. Alle Rechte vorbehalten.</p>
    <p>Made with â¤ï¸ in Weinheim</p>
  </div>
</footer>

<script src="/static/js/main.js"></script>
<script>
let files=[];
const fileInput=document.getElementById('fileInput');
const uploadBox=document.getElementById('uploadBox');
const fileListBox=document.getElementById('fileListBox');
const fileList=document.getElementById('fileList');
uploadBox.onclick=()=>fileInput.click();
fileInput.onchange=(e)=>addFiles(e.target.files);
uploadBox.ondragover=(e)=>{e.preventDefault();uploadBox.style.borderColor='#FFB900';};
uploadBox.ondragleave=()=>uploadBox.style.borderColor='#e5e7eb';
uploadBox.ondrop=(e)=>{e.preventDefault();uploadBox.style.borderColor='#e5e7eb';addFiles(e.dataTransfer.files);};
function addFiles(newFiles){for(let f of newFiles){if(f.size>20*1024*1024){alert(f.name+' ist zu groÃŸ (max. 20 MB)');continue;}files.push(f);}showFiles();}
function showFiles(){if(files.length===0){fileListBox.style.display='none';return;}fileListBox.style.display='block';document.getElementById('fileCount').textContent=files.length;fileList.innerHTML='';files.forEach((f,i)=>{const icon=f.type==='application/pdf'?'ğŸ“•':'ğŸ–¼ï¸';const div=document.createElement('div');div.style='display:flex;justify-content:space-between;align-items:center;padding:20px;border:1px solid #e5e7eb;border-radius:12px;margin-bottom:12px;transition:all 0.2s;';div.innerHTML='<div style="display:flex;align-items:center;gap:20px;"><span style="font-size:2.5rem;">'+icon+'</span><div><div style="font-weight:600;color:#003856;">'+f.name+'</div><div style="font-size:0.9rem;color:#666;">'+(f.size/1024/1024).toFixed(2)+' MB</div></div></div><button onclick="removeFile('+i+')" style="background:#ef4444;color:white;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:600;">âœ• Entfernen</button>';fileList.appendChild(div);});}
function removeFile(i){files.splice(i,1);showFiles();}
document.getElementById('processBtn').onclick=async()=>{if(files.length===0)return;fileListBox.style.display='none';document.getElementById('progressBox').style.display='block';try{const fd=new FormData();files.forEach(f=>fd.append('files',f));console.log('Uploading',files.length,'files...');const r=await fetch('/api/upload',{method:'POST',body:fd});const data=await r.json();console.log('Upload response:',data);if(data.error){alert(data.error);if(data.redirect)window.location.href=data.redirect;return;}const jobId=data.batch_id;console.log('Starting processing for job:',jobId);await fetch('/api/process/'+jobId,{method:'POST'});pollProgress(jobId);}catch(e){alert('Upload-Fehler: '+e.message);console.error(e);document.getElementById('progressBox').style.display='none';fileListBox.style.display='block';}};
async function pollProgress(jobId){const timer=setInterval(async()=>{try{const r=await fetch('/api/status/'+jobId);const d=await r.json();console.log('Status:',d);if(d.status==='completed'){clearInterval(timer);window.location.href='/job/'+jobId;}else if(d.status==='error'){clearInterval(timer);alert('Verarbeitungsfehler');}const pct=((d.processed||0)/(d.total||1)*100);document.getElementById('progressFill').style.width=pct+'%';document.getElementById('progressText').textContent=(d.processed||0)+' von '+(d.total||0)+' Dateien verarbeitet';}catch(e){console.error('Poll error:',e);}},1000);}
fetch('/api/user').then(r=>r.json()).then(u=>{if(u.logged_in&&u.name)document.getElementById('accountName').textContent=u.name;}).catch(e=>console.error(e));
</script>
</body>
</html>
